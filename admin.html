<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin — Candidatures locales</title>
  <style>
    body { font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial; background:#f3f4f6; padding:24px; color:#0f172a; }
    h1 { color:#004aad; margin-bottom:12px; }
    .app { background:#fff; padding:14px; border-radius:8px; box-shadow:0 6px 18px rgba(2,6,23,0.06); margin-bottom:12px; }
    .meta { font-size:13px; color:#6b7280; margin-top:8px; }
    .controls { margin-top:18px; display:flex; gap:8px; }
    button { padding:8px 12px; border-radius:8px; border:none; cursor:pointer; font-weight:600; }
    .btn-delete { background:#ef4444; color:white; }
    .btn-refresh { background:#0ea5a4; color:white; }
    .empty { color:#6b7280; }
  </style>
</head>
<body>
  <h1>Candidatures enregistrées localement</h1>
  <div class="controls">
    <button class="btn-refresh" onclick="render()">Rafraîchir</button>
    <button class="btn-delete" onclick="clearAll()">Supprimer toutes (local)</button>
  </div>
  <div id="apps" style="margin-top:16px"></div>

  <script>
    function render(){
      const container = document.getElementById('apps');
      container.innerHTML = '';
      const apps = JSON.parse(localStorage.getItem('applications')) || [];
      if(!apps.length){
        container.innerHTML = '<p class="empty">Aucune candidature enregistrée localement.</p>';
        return;
      }
      apps.forEach((app, i) => {
        const div = document.createElement('div');
        div.className = 'app';
        div.innerHTML = `
          <div><strong>Poste :</strong> ${escapeHtml(app.job)}</div>
          <div><strong>Email :</strong> ${escapeHtml(app.email)}</div>
          <div><strong>Note :</strong> ${escapeHtml(app.note||'')}</div>
          <div class="meta">Soumis le ${escapeHtml(app.date)}</div>
          <div style="margin-top:8px"><button style="background:#ef4444;color:white;border:none;padding:6px 10px;border-radius:6px" onclick="deleteOne(${i})">Supprimer</button></div>
        `;
        container.appendChild(div);
      });
    }

    function deleteOne(index){
      if(!confirm('Supprimer cette candidature localement ?')) return;
      const apps = JSON.parse(localStorage.getItem('applications')) || [];
      apps.splice(index,1);
      localStorage.setItem('applications', JSON.stringify(apps));
      render();
    }

    function clearAll(){
      if(!confirm('Supprimer toutes les candidatures stockées localement ?')) return;
      localStorage.removeItem('applications');
      render();
    }

    function escapeHtml(s){ return String(s||'').replace(/[&<>"'\/]/g, function(c){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','/':'\\/'}[c]; }); }

    // render au chargement
    render();
  </script>
</body>
</html>
